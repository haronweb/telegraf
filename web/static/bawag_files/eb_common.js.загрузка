//+++++++++++++++++++++++++++++++++++++++++++++++++++++
//  $Header$
//
//
//    (c) Copyright 2010 BAWAG P.S.K. | Gruppe
//    All Rights Reserved.
//+++++++++++++++++++++++++++++++++++++++++++++++++++++
//*****************************************************
// Submit initial/forced pin change page
//*****************************************************
function submitInitialForcedPinChange(form) {
 if (formSubmitted == true) {
  return false;
 }
 // Validation
 if (jsValidation) {
  if(form.newpassword.value.length == 0) {
   showErrorText(Messages.ERR_PIN_CHANGE_NO_NEW_PIN);
   resetInitialForcedPinChange(form);
   form.newpassword.focus();
   return false;
  }
  if(form.newpassword.value!=form.retypenewpassword.value) {
   showErrorText(Messages.ERR_PIN_CHANGE_NEW_PINS_NOT_IDENTICAL);
   resetInitialForcedPinChange(form);
   form.retypenewpassword.focus();
   return false;
  }
 }
 
 form.submitflag.value = true;
 submitForm(form);
}
function resetInitialForcedPinChange(form) {
  if (form.newpassword != null) {
    form.newpassword.value = '';
  }
  if (form.retypenewpassword != null) {
    form.retypenewpassword.value = '';
  }
}

//*****************************************************
// Login-functions
//*****************************************************
function nextfield(form, myEvent) {

 if (!window.event) {
  // Mozilla/Firefox implementation
  if (myEvent.which == 13) {
    form.pin.focus();
  }
 } else {
  // IE implementation
  if (window.event.keyCode == 13) {
    form.pin.focus();
  }
 }
 return true;
}

function nextfieldSubmit(form, myEvent) {

 if (!window.event) {
  // Mozilla/Firefox implementation
  if (myEvent.which == 13) {
    submitLogin(form);
  }
 } else {
  // IE implementation
  if (window.event.keyCode == 13) {   
    submitLogin(form)
  }
 }
}

//*****************************************************
// Submit login page
//*****************************************************
function submitLogin(form) {
 if (formSubmitted == true) {
  return false;
 }
 // Validation
 if (jsValidation) {
 
   var lbl_lof5;
   var lbl_lof9;
 
  var inst = form.svc.value;
  if (inst != EASYBANK) {
    lbl_lof5 = document.getElementById('lbl_lof5');
    lbl_lof9 = document.getElementById('lbl_lof9');
  }
 
  // clear previously marked error border / error font
  var rgxClassError = new RegExp("\\s*\\berror\\b", "gi");
  if (rgxClassError.test(form.dn.className)) {
    form.dn.className = form.dn.className.replace(rgxClassError, "");
  }
  if (rgxClassError.test(form.pin.className)) {
    form.pin.className = form.pin.className.replace(rgxClassError, "");
  }
  if (inst != EASYBANK) {
    try {
      lbl_lof5.className = lbl_lof5.className.replace(rgxClassError, "");
      lbl_lof9.className = lbl_lof9.className.replace(rgxClassError, "");
    } catch (e) {
      // ignore
    }
  }
  
  if (form.dn.value.length == 0) {
   showErrorText(Messages.ERR_LOGIN_TN_IV);
   form.dn.className += " error";
   if (inst != EASYBANK) {
    try {
      lbl_lof5.className += " error";
    } catch (e) {
      // ignore
    }
   }
   form.dn.focus();
   setLinkHeight(form);
   return false;
  }
  if (form.pin.value.length == 0) {
   showErrorText(Messages.ERR_LOGIN_PIN_IV);
   form.pin.className += " error";
   if (inst != EASYBANK) {
    try {
      lbl_lof9.className += " error";
    } catch (e) {
      // ignore
    }   
   }
   form.pin.focus();
   setLinkHeight(form);
   return false;
  }  
  if (form.pin.value.length < 5) {
   showErrorText(Messages.ERR_LOGIN_NO_PIN);
   form.pin.className += " error";
   if (inst != EASYBANK) {
    try {
      lbl_lof9.className += " error";
    } catch (e) {
      // ignore
    }   
   }
   form.pin.focus();
   setLinkHeight(form);
   return false;
  }  
 }
 
 addHiddenParamToForm(form, "rd", $.urlParam('rd'));

 form.submitflag.value = true; 
 submitForm(form);
}
//*****************************************************
//Gets URL parameter from the window
//*****************************************************
$.urlParam = function(name){
  var results = new RegExp('[\\?&]' + name + '=([^&#]*)').exec(window.location.href);
  if (results==null) {
    return "";
  } else {
    return results[1] || 0;
  } 
}

//*****************************************************
// Submit login signaturecard page
//*****************************************************
function submitSignaturecardLogin(form) {
 if (formSubmitted == true) {
  return false;
 }
 
 form.submitflag.value = true; 
 form.d.value = 'dsiglogin';
 submitForm(form);
}

//*****************************************************
// Submit dynamic info page
//*****************************************************
function submitDynamicInfo(form, gotoOverview) {
 if (formSubmitted == true) {
  return false;
 }
 
 form.mode.value = 'redirect';
 form.overview.value = gotoOverview;
 submitForm(form);
}

function getSelectedAccountValue() {
var values = {};
values["konto"] = "all";
return values;
}

function submitBroadcastMessageButton(settings) {
  if (settings.externalLink) {
    window.open(settings.externalLink);
  }
  if(settings.LoanAmount && settings.LoanDuration) {
      navigateTo(document.navigationform, "dynamicinfo", {buttonId: settings.buttonId, LoanAmount: settings.LoanAmount, LoanDuration: settings.LoanDuration,mode : 'redirect'});
  } else {
      if(settings.AcceptedDate) {
          navigateTo(document.navigationform, "dynamicinfo", {buttonId: settings.buttonId, AcceptedDate: settings.AcceptedDate, mode : 'redirect'});
      } else {
          navigateTo(document.navigationform, "dynamicinfo", {buttonId: settings.buttonId, mode : 'redirect'});  
      }
  }
}

function submitBroadcastMessage1Button(settings) {
  if (settings.externalLink) {
    window.open(settings.externalLink);
  } 
  if (settings.LoanAmount && settings.LoanDuration) {
      navigateTo(document.navigationform, "inbox", {buttonId: settings.buttonId, mode : 'redirect', messageId: settings.messageId, LoanAmount: settings.LoanAmount, LoanDuration: settings.LoanDuration});      
  } else {
      navigateTo(document.navigationform, "inbox", {buttonId: settings.buttonId, mode : 'redirect', messageId: settings.messageId});
  }
}

function setLinkHeight(form){
    var mainBox = "";
    var loginBox = "";
    var inst = form.svc.value;
    if (inst == EASYBANK) {
        mainBox = "450";
        var box1 = $("#boxGreen1").height();
        var box2 = $("#boxGreen2").height();
        loginBox = box1 + box2 + 46;
    }else{
        mainBox = "438";
        loginBox = $("#form").height() - 2;
        
    }
    
    var vacantSpace = mainBox - loginBox;
    $("#boxGreen3Link").height(vacantSpace);
    return false;
}
