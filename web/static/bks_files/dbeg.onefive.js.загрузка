!function(e,t,o,n){e.widget("dbeg.onefive",{showNose:!1,showCustomHeaderExtension:!1,showCustomTemplateHeaderExtension:!1,oneFiveLayer:null,portletId:"",activeStep:0,maxSteps:0,me:null,oneFiveTriggerSelector:".js-one-five-trigger",layerClosingButton:{},downloadButton:{},customHeaderExtension:{},customTemplateHeaderExtension:{},warnBeforeClosing:!1,isFormPristine:!0,downloadLinks:[],variableLayerClosingButton:null,warningTipsy:{okButtonText:"",cancelButtonText:"",tipsyText:""},downloadTipsy:{cancelButtonText:"",tipsyText:""},options:{hasMultipleSteps:!1,amountOfSteps:0,data:[],animationTime:5e3,animationTimeScrolling:1e3,scrollOffset:0,oneFiveContainer:null},_create:function(){me=this;var t=this.element,o=this.options,n=null;if(portletId=o.data.portletId,portletId?n=e("#"+portletId):console.error("data-portlet-id attribute is missing",o),t.hasClass("active"))me._close(t);else{e("#one-five").is(":visible")&&me._closeOneFiveLayer(),e(me.oneFiveTriggerSelector).removeClass("active"),t.addClass("active");var i=n.find(".one-five-custom-header"),a=n.find(".one-five-custom-template-header");oneFiveLayer=e('<div class="row" id="one-five">   <div class="col-xs-12 col-md-12">'+(me.options.data&&me.options.data.showNose?'<div class="nose-up"></div>':"")+'       <div class="one-five-body pref-single">           <header>               <div class="row">                   <div class="col-xs-10 col-sm-7 one-five-header-title"></div>                   <div class="right-aligned one-five-header-button-container"></div>               </div>           </header>       </div>   </div></div>');var s=e("<h2>"+o.data.portletTitle+"</h2>"),l=o.data.closeButtonTitle,d=o.data.downloadButtonTitle;l||(l="Schlie√üen"),d||(d="Download");var r=e('<button id="download-button" class="db-btn db-btn-icon primary" type="button" title="'+d+'"><i class="dbit-icons">download</i></button>'),m=e('<button id="close-button" type="button" title="'+l+'" class="db-btn db-btn-icon primary js-db-main-close-button"><i class="dbit-icons">close</i></button>');m.bind("click",function(){me._close(!1)}),me.layerClosingButton=m,me.downloadButton=r,me.customHeaderExtension=i,me.customTemplateHeaderExtension=a,me.setSteps(o.amountOfSteps),oneFiveLayer.find(".one-five-header-title").append(s),oneFiveLayer.find(".one-five-header-button-container").append(r),oneFiveLayer.find(".one-five-header-button-container").append(m),0===oneFiveLayer.find(".one-five-custom-header").length&&oneFiveLayer.find(".one-five-header-button-container").after(i),0===oneFiveLayer.find(".one-five-custom-template-header").length&&oneFiveLayer.find(".one-five-header-button-container").after(a),me.options.data&&!0===me.options.data.showCustomHeaderExtension&&i.show(),me.options.data&&!0===me.options.data.showCustomTemplateHeaderExtension&&a.show(),r.hide(),n.addClass("portlet"),oneFiveLayer.find(".one-five-body").append(n),me.options.oneFiveContainer?(me.options.oneFiveContainer.append(oneFiveLayer),oneFiveLayer.fadeIn(o.animationTime),me._scroll(me.options.scrollOffset),PubSub.publish(DBEG.WebShopConstants.EventConstants.ONE_FIVE_LOADED)):console.error("oneFiveContainer not found. please add oneFiveContainer to the options.")}},_getWarningTipsyHtml:function(e){return me.variableLayerClosingButton=e,'   <div class="tipsy-text">       '+me.warningTipsy.tipsyText+'   </div>   <div class="tipsy-footer">       <div class="button-container">           <button class="cta-button-plain db-btn" onclick="DBEG.portletManager.cancelClosingCallback();me.variableLayerClosingButton.tipsy(\'hide\')">               '+me.warningTipsy.cancelButtonText+'           </button>           <button class="cta-button accent" onclick="DBEG.portletManager.setIgnoreNextDropdownEnabling(); me._close(true)">               '+me.warningTipsy.okButtonText+"           </button>       </div>"},_getDownloadTipsyHtml:function(){for(var e="",t=0;t<me.downloadLinks.length;t++)e+='<button class="cta-button downloadable width-one-third-important" data-url="'+me.downloadLinks[t].link+'">   '+me.downloadLinks[t].format+"</button>";return'   <div class="tipsy-text">       '+me.downloadTipsy.tipsyText+'   </div>   <div class="tipsy-footer">       <div class="button-container w100">'+e+'</div>       <div class="button-container w100">           <button class="cta-button-plain w100" onclick="me.downloadButton.tipsy(\'hide\')">               '+me.downloadTipsy.cancelButtonText+"           </button>       </div>   </div>"},_close:function(t,o){if(t&&(me.layerClosingButton.tipsy("hide"),me.variableLayerClosingButton&&me.variableLayerClosingButton.tipsy&&me.variableLayerClosingButton.tipsy("hide")),me.warnBeforeClosing&&!me.isFormPristine&&!t){var n=o||me.layerClosingButton;return n.tipsy({gravity:e.fn.tipsy.autoNS,delayIn:0,fade:!1,offset:0,opacity:1,html:!0,className:"tipsy-tile tipsy-tile-add-dashboard",trigger:"manual",title:function(){return me._getWarningTipsyHtml(n)}}),n.tipsy("show"),void me._scrollToTipsy()}me._closeOneFiveLayer(),e(me.oneFiveTriggerSelector).removeClass("active"),PubSub.publish(DBEG.WebShopConstants.EventConstants.EVENT_PORTLET_HIDDEN)},_closeOneFiveLayer:function(){var t=e("#one-five"),o=t.find(".portlet");o.removeClass("portlet"),t.find(".additional-download-button").length>0&&e(".additional-download-button").remove(),t.find(".one-five-custom-header").length>0?me.customHeaderExtension.remove():me.customHeaderExtension&&(t.find('[id$="WAR_accountportlet_"]').prepend(me.customHeaderExtension),me.customHeaderExtension.hide&&me.customHeaderExtension.hide()),t.find(".one-five-custom-template-header").length>0?me.customHeaderExtension.hide&&me.customTemplateHeaderExtension.remove():me.customTemplateHeaderExtension&&(t.find('[id$="WAR_accountportlet_"]').prepend(me.customTemplateHeaderExtension),me.customTemplateHeaderExtension.hide&&me.customTemplateHeaderExtension.hide()),e("#portletPool").append(o),DBEG.EShop&&DBEG.EShop.setOneFiveLayer(null),t.remove(),this.destroy(),PubSub.publish(DBEG.WebShopConstants.EventConstants.ONE_FIVE_CLOSED)},_scroll:function(t){var o=0;e(".mobile-header").is(":visible")&&(o=e(".mobile-header").height());try{e("html,body").animate({scrollTop:e("#one-five").offset().top-o+(t||0)},me.options.animationTimeScrolling)}catch(e){console.error("error while scrolling the oneFiveLayer: ",e)}},_scrollToTipsy:function(){try{var o=e(t).scrollTop(),n=o+e(t).height(),i=e(".tipsy-tile.tipsy-tile-add-dashboard"),a=e(i).offset().top;a+e(i).height()<=n&&a>=o||e("html,body").animate({scrollTop:i.offset().top},me.options.animationTimeScrolling)}catch(e){console.error("error while scrolling the tipsy: ",e)}},highlightSteps:function(t){var o=e(".steps li");if(o.length>0&&o.length>=t)for(var n=0;n<t;n++);},setSteps:function(t){if(me.maxSteps=t>0?t:me.options.amountOfSteps>0?me.options.amountOfSteps:me.options.data.portletSteps>0?me.options.data.portletSteps:0,me.maxSteps>0){for(var o=e('<ol class="steps as-dots"></ol>'),n=0;n<me.maxSteps;n++){var i=e("<li>"+(n+1)+"</li>");0==n&&i.addClass("active"),o.append(i)}oneFiveLayer.find(".one-five-header-title").append(o)}},activateStep:function(t){if(me.maxSteps<=t)console.error("step "+t+" is not allowed as there are max. "+me.maxSteps+" available.");else{me.activeStep=parseInt(t);for(var o=oneFiveLayer.find(".one-five-header-title ol.steps li"),n=0;n<me.maxSteps;n++)n<=t?e(o[n]).addClass("active"):e(o[n]).removeClass("active")}},insertDownloadButton:function(t,o){oneFiveLayer.find(".additional-download-button").length<=0&&(oneFiveLayer.find("#download-button").after(t),e("#".concat(o)).addClass("additional-download-button"))},removeAdditionalDownloadButton:function(){oneFiveLayer.find(".additional-download-button").length>0&&e(".additional-download-button").remove()},toggleDownloadButton:function(t,n,i){me.downloadLinks=t,me.downloadTipsy.cancelButtonText=n,me.downloadTipsy.tipsyText=i,me.downloadButton.bind("click",function(){me.downloadButton.tipsy({gravity:e.fn.tipsy.autoNS,delayIn:0,fade:!1,offset:0,opacity:1,html:!0,className:"tipsy-tile tipsy-tile-add-dashboard downloadable",trigger:"manual",title:function(){return me._getDownloadTipsyHtml()}}),me.downloadButton.tipsy("show"),e(o).trigger("refreshDownloads")}),me.downloadButton.toggle()},hideDownloadButton:function(){me.downloadButton.hide()},setShowCustomHeaderExtension:function(e){me.showCustomHeaderExtension=e,!0===e?me.customHeaderExtension.show():me.customHeaderExtension.hide()},setShowCustomTemplateHeaderExtension:function(e){me.showCustomTemplateHeaderExtension=e,!0===e?me.customTemplateHeaderExtension.show():me.customTemplateHeaderExtension.hide()},activateNextStep:function(){me.activateStep(me.activeStep+1)},setTitle:function(e){oneFiveLayer.find(".one-five-header-title h2").html(e)},close:function(e){me._close(!1,e)},scroll:function(){me._scroll()},setFormDirty:function(){me.isFormPristine=!1},enableWarningBeforeClosing:function(t,o,n){me.warnBeforeClosing=!0,me.warningTipsy.okButtonText=t,me.warningTipsy.cancelButtonText=o,me.warningTipsy.tipsyText=n,e("#one-five input, #one-five select").change(function(){me.isFormPristine=!1})},disableWarningBeforeClosing:function(){me.warnBeforeClosing=!1,me.isFormPristine=!0}})}(jQuery,window,document);